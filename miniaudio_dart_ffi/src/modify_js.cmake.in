# modify_js.cmake.in
if(NOT DEFINED JS_FILE)
  message(FATAL_ERROR "JS_FILE not defined")
endif()
if(NOT EXISTS "${JS_FILE}")
  message(FATAL_ERROR "JS file not found: ${JS_FILE}")
endif()

file(READ "${JS_FILE}" JS_CONTENTS)
string(REPLACE 
    "audioWorklet.addModule(\"@MAIN_LIB@.aw.js\")" 
    "audioWorklet.addModule(locateFile(\"@MAIN_LIB@.aw.js\"))" 
    MODIFIED_JS_CONTENT "${JS_CONTENTS}"
)
file(WRITE "${JS_FILE}" "${MODIFIED_JS_CONTENT}")  # fixed var name